generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Profile {
  id                    String        @id
  nickname              String
  remark                String?
  avatarInfo            String?
  momentsBackgroundInfo String?
  momentsBackgroundLike Boolean       @default(false)
  momentsPrivacy        String        @default("all")
  tickleText            String?
  wechat                String        @unique
  coin                  Int           @default(0)
  isStarred             Boolean       @default(false)
  gender                String?
  hideGender            Boolean       @default(false)
  phone                 String[]
  tags                  String[]
  description           String?
  area                  String?
  signature             String?
  privacy               String        @default("all")
  thumbnailInfo         String[]
  hideThumbnail         Boolean       @default(false)
  createdByFaker        Boolean       @default(false)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  assets                Asset[]
  friendDialogues       Dialogue[]    @relation("FriendDialogues")
  dialogues             Dialogue[]    @relation("ProfileDialogues")
  feedComments          FeedComment[]
  feeds                 Feed[]
  transactions          Transaction[]
  wallet                Wallet?
  likedFeeds            Feed[]        @relation("FeedLikes")

  @@map("profiles")
}

model Wallet {
  id            String   @id
  profileId     String   @unique
  balance       Decimal  @default(0) @db.Decimal(10, 2)
  miniFund      Decimal  @default(0) @db.Decimal(10, 2)
  miniFundYield Decimal  @default(0) @db.Decimal(5, 2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  profile       Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("wallets")
}

model Dialogue {
  id                String    @id
  profileId         String
  friendId          String
  lastMessage       String?
  lastMessageTime   DateTime?
  isPinned          Boolean   @default(false)
  isMuted           Boolean   @default(false)
  badgeHide         Boolean   @default(false)
  unreadMarkNumber  Int       @default(0)
  unreadDisplayType String    @default("number")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  friend            Profile   @relation("FriendDialogues", fields: [friendId], references: [id], onDelete: Cascade)
  profile           Profile   @relation("ProfileDialogues", fields: [profileId], references: [id], onDelete: Cascade)

  @@map("dialogues")
}

model Conversation {
  id          String
  dialogueId  String
  role        String
  type        String
  content     Json?
  upperText   String?
  referenceId String?
  createdAt   DateTime @default(now())

  @@unique([id, dialogueId], map: "conversations_unique")
  @@map("conversations")
}

model Feed {
  id            String        @id
  userId        String
  content       Json
  sendTimestamp BigInt
  likeUserIds   String[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  comments      FeedComment[]
  user          Profile       @relation(fields: [userId], references: [id], onDelete: Cascade)
  likedBy       Profile[]     @relation("FeedLikes")

  @@map("feeds")
}

model FeedComment {
  id            String   @id
  feedId        String
  fromUserId    String
  replyUserId   String?
  content       Json
  sendTimestamp BigInt
  createdAt     DateTime @default(now())
  feed          Feed     @relation(fields: [feedId], references: [id], onDelete: Cascade)
  fromUser      Profile  @relation(fields: [fromUserId], references: [id], onDelete: Cascade)

  @@map("feed_comments")
}

model Transaction {
  id            String   @id
  profileId     String
  type          String
  amount        Decimal  @db.Decimal(10, 2)
  timestamp     BigInt
  code          String?
  paymentMethod String?
  data          Json?
  createdAt     DateTime @default(now())
  profile       Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Asset {
  id        String   @id
  profileId String
  fileName  String?
  fileSize  BigInt?
  mimeType  String?
  filePath  String?
  url       String?
  createdAt DateTime @default(now())
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("assets")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model conversation_items {
  id                         String   @db.VarChar(64)
  dialogue_id                String   @db.VarChar(64)
  type                       String   @db.VarChar(32)
  role                       String   @db.VarChar(16)
  send_timestamp             Int?
  upper_text                 String?
  text_content               Json?
  reference_id               String?  @db.VarChar(64)
  simple_content             String?
  extra_class_name           String?
  original_sender            String?  @db.VarChar(16)
  transfer_status            String?  @db.VarChar(16)
  transfer_amount            Decimal? @db.Decimal(18, 2)
  transfer_note              String?
  red_packet_original_sender String?  @db.VarChar(16)
  red_packet_status          String?  @db.VarChar(16)
  red_packet_amount          Decimal? @db.Decimal(18, 2)
  red_packet_note            String?
  red_packet_id              String?  @db.VarChar(64)
  image_info                 String?
  video_info                 String?
  voice_duration             Int?
  voice_is_read              Boolean?
  voice_show_stt             Boolean?
  voice_stt                  String?
  personal_card_avatar_info  String?
  personal_card_nickname     String?

  @@unique([id, dialogue_id], map: "conversation_items_1_unique")
}
